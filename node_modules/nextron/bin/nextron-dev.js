#!/usr/bin/env node
"use strict";var e=require("arg"),r=require("chalk"),t=require("execa"),n=require("delay"),o=require("webpack"),c=require("fs"),s=require("path"),a=require("webpack-merge");function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u=l(e),i=l(r),d=l(t),p=l(n),f=l(o),b=l(c),j=l(s),g=l(a);const m=process.cwd(),y=require(j.default.join(m,"package.json")).dependencies,h=e=>{try{return b.default.accessSync(e,b.default.constants.F_OK),!0}catch(e){return!1}};const O=e=>{try{return b.default.accessSync(e,b.default.constants.F_OK),!0}catch(e){return!1}},v=process.cwd(),w=O(j.default.join(v,"tsconfig.json"))?".ts":".js",x=()=>{const e=j.default.join(v,"nextron.config.js");return O(e)?require(e):{}},k=e=>{const{mainSrcDir:r,webpack:t}=x(),n=g.default((e=>({mode:e,target:"electron-main",node:{__dirname:!1,__filename:!1},externals:[...Object.keys(y||{})],devtool:"source-map",resolve:{extensions:[".js",".jsx",".json",".ts",".tsx"],modules:[j.default.join(m,"app"),"node_modules"]},output:{libraryTarget:"commonjs2"},module:{rules:[{test:/\.(js|ts)x?$/,use:{loader:require.resolve("babel-loader"),options:{cacheDirectory:!0,extends:h(j.default.join(m,".babelrc"))?j.default.join(m,".babelrc"):h(j.default.join(m,".babelrc.js"))?j.default.join(m,".babelrc.js"):h(j.default.join(m,"babel.config.js"))?j.default.join(m,"babel.config.js"):j.default.join(__dirname,"../babel.js")}},exclude:[/node_modules/,j.default.join(m,"renderer")]}]},plugins:[new f.default.EnvironmentPlugin({NODE_ENV:e})]}))(e),{entry:{background:j.default.join(v,r||"main",`background${w}`)},output:{filename:"[name].js",path:j.default.join(v,"app")}}),o=t||{};return"function"==typeof o?o(n,e):g.default(n,o)};function q(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function P(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}const S=u.default({"--help":Boolean,"--version":Boolean,"--port":Number,"--remote-debugging-port":Number,"--inspect":Number,"--run-only":Boolean,"-h":"--help","-v":"--version","-p":"--port","-r":"--run-only"});S["--help"]&&(console.log(i.default`
    {bold.cyan nextron dev} - Starts the nextron application in development mode

    {bold USAGE}

      {bold $} {cyan nextron dev} --help
      {bold $} {cyan nextron dev}

    {bold OPTIONS}

      --help,    -h  shows this help message
      --version, -v  displays the current version of nextron
  `),process.exit(0));const _=S["--port"]||8888,D=S["--remote-debugging-port"]||5858,E=S["--inspect"]||9292,N={cwd:process.cwd(),stdio:"inherit"};!async function(){const{rendererSrcDir:e}=x();let r,t,n,o=!0;const c=()=>{t=d.default("electron",[".",`${_}`,`--remote-debugging-port=${D}`,`--inspect=${E}`],function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?q(Object(t),!0).forEach((function(r){P(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):q(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({detached:!0},N)),t.unref()},s=()=>{r&&r.close((()=>{})),t&&t.kill(),n&&n.kill()},a=async e=>{e&&(console.error(e.stack||e),e.stack&&console.error(e.stack)),o&&(o=!1),e||(!o&&t&&t.kill(),c())};process.on("SIGINT",s),process.on("SIGTERM",s),process.on("exit",s),n=(()=>{const r=d.default("next",["-p",_,e||"renderer"],N);return r.on("close",(()=>{process.exit(0)})),r})(),await p.default(8e3);const l=f.default(k("development"));S["--run-only"]?l.run(a):r=l.watch({},a)}();
